"use strict";var Chat=function(a){this.socket=a};Chat.prototype.sendMessage=function(a,b){this.socket.emit("message",{room:a,text:b})},Chat.prototype.changeRoom=function(a){this.socket.emit("join",{newRoom:a})},Chat.prototype.commandExec=function(a){var b,c,d=a.split(" "),a=d[0].substring(1,d[0].length).toLowerCase(),e=!1;switch(a){case"join":d.shift(),b=d.join(" "),this.changeRoom(b);break;case"nick":d.shift(),c=d.join(" "),this.socket.emit("nameChange",c);break;default:e="u wot m8??"}return e};var $message=$("#chat-form__msg"),$messages=$("#messages"),$room=$("#room"),$roomList=$("#room-list"),$form=$("#chat-form"),message,systemMessage,sanitizedContent=function(a){return $("<div/>").text(a)},trustedContent=function(a){return $("<div/>").html("<i>"+a+"</i>")},processUserInput=function(a,b){message=$message.val(),"/"===message.charAt(0)?(systemMessage=a.commandExec(message),systemMessage&&$messages.append(trustedContent(systemMessage))):(a.sendMessage($room.text(),message),$messages.append(sanitizedContent(message)),$messages.scrollTop($messages.prop("scrollHeight"))),$message.val("")},socket=io();$(document).ready(function(){var a=new Chat(socket);socket.on("nameResult",function(a){var b;b=a.success?"You have respawned as "+a.name+".":a.message,$messages.append(trustedContent(b))}),socket.on("joinResult",function(a){$room.text(a.room),$messages.append(trustedContent("Jumped into "+a.room+" bandwagon"))}),socket.on("message",function(a){var b=$("<div></div>").text(a.text);$messages.append(b)}),socket.on("rooms",function(b){$roomList.empty();for(var c in b)""!==c&&$roomList.append(sanitizedContent(c));$roomList.find("div").on("click",function(b){a.commandExec("/join "+$(this).text()),$message.focus()})});var b=setTimeout(function c(){socket.emit("rooms"),b=setTimeout(c,3e3)},1e3);$message.focus(),$form.submit(function(b){return processUserInput(a,socket),!1})});